#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö —Å—É–±–≥—Ä–∞—Ñ–æ–≤

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö GraphQL —Å—É–±–≥—Ä–∞—Ñ–æ–≤..."

if [ -f "subgraph_pids.txt" ]; then
    while read pid; do
        if kill -0 $pid 2>/dev/null; then
            echo "üîÑ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ $pid..."
            kill $pid
        fi
    done < subgraph_pids.txt
    
    # –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
    sleep 2
    
    # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ–º, –µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã –µ—â–µ —Ä–∞–±–æ—Ç–∞—é—Ç
    while read pid; do
        if kill -0 $pid 2>/dev/null; then
            echo "‚ö° –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ $pid..."
            kill -9 $pid
        fi
    done < subgraph_pids.txt
    
    rm -f subgraph_pids.txt
    echo "‚úÖ –í—Å–µ —Å—É–±–≥—Ä–∞—Ñ—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
else
    echo "‚ÑπÔ∏è  –§–∞–π–ª —Å PID'–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—ã—Ç–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –ø–æ –ø–æ—Ä—Ç–∞–º..."
    
    # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø–æ –ø–æ—Ä—Ç–∞–º
    for port in 4001 4002 4003 4004 4005 4006 4007 4008; do
        pid=$(lsof -ti:$port)
        if [ ! -z "$pid" ]; then
            echo "üîÑ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–∞ –ø–æ—Ä—Ç—É $port (PID: $pid)..."
            kill $pid
        fi
    done
    
    echo "‚úÖ –ü—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
fi
