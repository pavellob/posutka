# Cleaning Subgraph - Управление уборками
# Отвечает за создание уборщиков, шаблонов уборки, планирование и выполнение уборок

scalar UUID
scalar DateTime
scalar Upload
scalar JSON

"""
Информация о пагинации для соединений (connections).
"""
type PageInfo {
  """Есть ли следующая страница результатов"""
  hasNextPage: Boolean!
  """Есть ли предыдущая страница результатов"""
  hasPreviousPage: Boolean!
  """Курсор для начала текущей страницы"""
  startCursor: String
  """Курсор для конца текущей страницы"""
  endCursor: String
  """Общее количество элементов"""
  totalCount: Int
}

"""
Запросы для работы с уборками.
"""
type Query {
  """Получить уборщика по ID"""
  cleaner(id: UUID!): Cleaner
  
  """Получить список уборщиков"""
  cleaners(
    """ID организации для фильтрации"""
    orgId: UUID!
    """Только активные уборщики"""
    isActive: Boolean
    """Количество элементов на странице"""
    first: Int
    """Курсор для пагинации"""
    after: String
  ): CleanerConnection!
  
  """Получить привязанных уборщиков для квартиры"""
  unitPreferredCleaners(
    """ID единицы недвижимости"""
    unitId: UUID!
  ): [CleanerPreference!]!
  
  """Получить шаблон уборки по ID"""
  cleaningTemplate(id: UUID!): CleaningTemplate
  
  """Получить шаблоны уборки для квартиры"""
  cleaningTemplates(
    """ID единицы недвижимости"""
    unitId: UUID!
  ): [CleaningTemplate!]!
  
  """Получить уборку по ID"""
  cleaning(id: UUID!): Cleaning
  
  """Получить уборку по ID задачи"""
  cleaningByTask(taskId: UUID!): Cleaning
  
  """Получить список уборок с фильтрацией"""
  cleanings(
    """ID организации для фильтрации"""
    orgId: UUID
    """ID единицы недвижимости для фильтрации"""
    unitId: UUID
    """ID уборщика для фильтрации"""
    cleanerId: UUID
    """ID бронирования для фильтрации"""
    bookingId: UUID
    """ID связанной задачи для фильтрации"""
    taskId: UUID
    """Статус уборки для фильтрации"""
    status: CleaningStatus
    """Начальная дата для фильтрации"""
    from: DateTime
    """Конечная дата для фильтрации"""
    to: DateTime
    """Количество элементов на странице"""
    first: Int
    """Курсор для пагинации"""
    after: String
  ): CleaningConnection!
  
  """Получить список чеклистов для квартиры"""
  checklistsByUnit(unitId: UUID!): [ChecklistTemplate!]!
  
  # ===== Новая модель чек-листов (Template → Instance → Promote) =====
  
  """Получить инстанс чек-листа по ID"""
  checklistInstance(id: UUID!): ChecklistInstance
  
  """Получить инстанс чек-листа по юниту и стадии"""
  checklistByUnitAndStage(unitId: UUID!, stage: ChecklistStage!): ChecklistInstance
  """Получить инстанс чек-листа по уборке и стадии"""
  checklistByCleaning(cleaningId: UUID!, stage: ChecklistStage!): ChecklistInstance
  
  """Получить шаблон чек-листа для юнита"""
  checklistTemplate(unitId: UUID!, version: Int): ChecklistTemplate
}

"""
Мутации для управления уборками.
"""
type Mutation {
  # Уборщики
  """Создать нового уборщика"""
  createCleaner(input: CreateCleanerInput!): Cleaner!
  
  """Обновить данные уборщика"""
  updateCleaner(id: UUID!, input: UpdateCleanerInput!): Cleaner!
  
  """Деактивировать уборщика (soft delete)"""
  deactivateCleaner(id: UUID!): Cleaner!
  
  """Активировать уборщика (отменить деактивацию)"""
  activateCleaner(id: UUID!): Cleaner!
  
  # Шаблоны уборки
  """Создать шаблон уборки для квартиры"""
  createCleaningTemplate(input: CreateCleaningTemplateInput!): CleaningTemplate!
  
  """Обновить шаблон уборки"""
  updateCleaningTemplate(id: UUID!, input: UpdateCleaningTemplateInput!): CleaningTemplate!
  
  """Удалить шаблон уборки"""
  deleteCleaningTemplate(id: UUID!): Boolean!
  
  # Уборки
  """Запланировать уборку"""
  scheduleCleaning(input: ScheduleCleaningInput!): Cleaning!
  
  """Начать уборку"""
  startCleaning(id: UUID!): Cleaning!
  
  """Завершить уборку"""
  completeCleaning(id: UUID!, input: CompleteCleaningInput!): Cleaning!
  
  """Одобрить уборку менеджером"""
  approveCleaning(id: UUID!, managerId: UUID!, comment: String): Cleaning!
  
  """Отменить уборку"""
  cancelCleaning(id: UUID!, reason: String): Cleaning!
  
  """Взять уборку в работу (самоназначение)"""
  assignCleaningToMe(cleaningId: UUID!): Cleaning!
  
  """Обновить чеклист уборки"""
  updateCleaningChecklist(id: UUID!, items: [ChecklistItemInput!]!): Cleaning!
  
  # Управление привязкой уборщиков к квартирам
  """Добавить уборщика в список предпочтительных для квартиры"""
  addPreferredCleaner(unitId: UUID!, cleanerId: UUID!): Unit!
  
  """Удалить уборщика из списка предпочтительных для квартиры"""
  removePreferredCleaner(unitId: UUID!, cleanerId: UUID!): Unit!
  
  # Документы уборки
  """Создать документ приемки квартиры перед уборкой"""
  createPreCleaningDocument(cleaningId: UUID!, input: CreateCleaningDocumentInput!): CleaningDocument!
  
  """Создать документ сдачи квартиры после уборки"""
  createPostCleaningDocument(cleaningId: UUID!, input: CreateCleaningDocumentInput!): CleaningDocument!
  
  """Добавить фото к документу"""
  addPhotoToDocument(documentId: UUID!, input: AddPhotoInput!): CleaningDocumentPhoto!
  
  """Удалить фото из документа"""
  deletePhotoFromDocument(photoId: UUID!): Boolean!
  
  # Чек-листы с фото
  """Создать чек-лист"""
  createChecklist(input: CreateChecklistInput!): Checklist!
  
  """Активировать чек-лист (деактивирует остальные для этого юнита)"""
  activateChecklist(id: UUID!): Checklist!
  
  """Удалить чек-лист"""
  deleteChecklist(id: UUID!): Boolean!
  
  """Обновить порядок пунктов чек-листа"""
  updateChecklistItemOrder(checklistId: UUID!, itemIds: [UUID!]!): Checklist!
  
  # ===== Новая модель чек-листов (Template → Instance → Promote) =====
  
  """Создать инстанс чек-листа"""
  createChecklistInstance(unitId: UUID!, stage: ChecklistStage!, cleaningId: UUID): ChecklistInstance!
  
  """Добавить пункт в инстанс"""
  addItem(input: AddItemInput!): ChecklistInstance!
  
  """Обновить пункт в инстансе"""
  updateItem(input: UpdateItemInput!): ChecklistInstance!
  
  """Удалить пункт из инстанса"""
  removeItem(instanceId: UUID!, itemKey: String!): ChecklistInstance!
  
  """Промоут инстанса в следующую стадию"""
  promoteChecklist(fromInstanceId: UUID!, toStage: ChecklistStage!): ChecklistInstance!
  
  """Отправить чек-лист"""
  submitChecklist(id: UUID!): ChecklistInstance!
  
  """Заблокировать чек-лист"""
  lockChecklist(id: UUID!): ChecklistInstance!
  
  """Добавить ответ на пункт"""
  answer(input: AnswerInput!): ChecklistInstance!
  
  """Добавить аттачмент (фото) к пункту"""
  attach(input: AttachmentInput!): ChecklistInstance!
  
  """Получить presigned URLs для загрузки фото к ответам"""
  getChecklistAttachmentUploadUrls(input: GetChecklistAttachmentUploadUrlsInput!): [PresignedUploadUrl!]!
  
  """Удалить аттачмент (фото) из пункта"""
  removeChecklistAttachment(attachmentId: UUID!): Boolean!
  
  # ===== Редактирование шаблона =====
  
  """Создать шаблон для юнита"""
  createChecklistTemplate(unitId: UUID!): ChecklistTemplate!
  
  """Добавить пункт в шаблон"""
  addTemplateItem(input: AddTemplateItemInput!): ChecklistTemplate!
  
  """Обновить пункт в шаблоне"""
  updateTemplateItem(input: UpdateTemplateItemInput!): ChecklistTemplate!
  
  """Удалить пункт из шаблона"""
  removeTemplateItem(templateId: UUID!, itemKey: String!): ChecklistTemplate!
  
  """Обновить порядок пунктов в шаблоне"""
  updateTemplateItemOrder(templateId: UUID!, itemKeys: [String!]!): ChecklistTemplate!
  
  """Добавить пример фото к пункту шаблона"""
  addTemplateItemExampleMedia(input: AddTemplateItemExampleMediaInput!): [ChecklistItemTemplateMedia!]!
  
  """Удалить пример фото из пункта шаблона"""
  removeTemplateItemExampleMedia(mediaId: UUID!): Boolean!
  
  """Получить presigned URLs для загрузки примеров фото"""
  getTemplateItemExampleMediaUploadUrls(input: GetTemplateItemExampleMediaUploadUrlsInput!): [PresignedUploadUrl!]!
}

# ===== Типы =====

"""
Пользователь системы (ссылка на identity-subgraph).
"""
type User {
  """Уникальный идентификатор пользователя"""
  id: UUID!
}

"""
Организация (ссылка на identity-subgraph).
"""
type Organization {
  """Уникальный идентификатор организации"""
  id: UUID!
}

# Единица недвижимости (stub для связи)
type Unit {
  id: UUID!
}

"""
Связь квартиры с предпочтительным уборщиком.
"""
type CleanerPreference {
  """ID связи"""
  id: UUID!
  """Уборщик"""
  cleaner: Cleaner!
  """Дата добавления"""
  createdAt: DateTime!
}

"""
Бронирование (ссылка на bookings-subgraph).
"""
type Booking {
  """Уникальный идентификатор бронирования"""
  id: UUID!
}

"""
Уборщик - сотрудник, выполняющий уборку.
Может быть INTERNAL (сотрудник с User) или EXTERNAL (подрядчик без User).
"""
type Cleaner {
  """Уникальный идентификатор уборщика"""
  id: UUID!
  """Тип уборщика"""
  type: CleanerType!
  """Пользователь системы (только для INTERNAL)"""
  user: User
  """Организация"""
  org: Organization!
  """Имя"""
  firstName: String!
  """Фамилия"""
  lastName: String!
  """Телефон"""
  phone: String
  """Email"""
  email: String
  """Telegram username (без @)"""
  telegramUsername: String
  """Рейтинг уборщика"""
  rating: Float
  """Активен ли уборщик"""
  isActive: Boolean!
  """Дата деактивации (soft delete)"""
  deletedAt: DateTime
  """Дата создания"""
  createdAt: DateTime!
  """Дата обновления"""
  updatedAt: DateTime!
  """Выполненные уборки"""
  cleanings: [Cleaning!]!
  """Квартиры, где уборщик предпочтителен"""
  preferredUnits: [UnitPreference!]!
}

"""
Связь уборщика с предпочтительной квартирой.
"""
type UnitPreference {
  """ID связи"""
  id: UUID!
  """Квартира"""
  unit: Unit!
  """Дата добавления"""
  createdAt: DateTime!
}

"""
Шаблон уборки для квартиры.
Содержит описание и чеклист для выполнения уборки.
"""
type CleaningTemplate {
  """Уникальный идентификатор шаблона"""
  id: UUID!
  """Единица недвижимости"""
  unit: Unit!
  """Название шаблона"""
  name: String!
  """Текстовое описание"""
  description: String
  """Требуется ли смена белья"""
  requiresLinenChange: Boolean!
  """Расчетная продолжительность в минутах"""
  estimatedDuration: Int
  """Чек-боксы для проверки"""
  checklistItems: [CleaningTemplateCheckbox!]!
  """Дата создания"""
  createdAt: DateTime!
  """Дата обновления"""
  updatedAt: DateTime!
}

"""
Чек-бокс в шаблоне уборки.
"""
type CleaningTemplateCheckbox {
  """Уникальный идентификатор чек-бокса"""
  id: UUID!
  """Текст пункта"""
  label: String!
  """Порядок отображения"""
  order: Int!
  """Обязателен ли пункт"""
  isRequired: Boolean!
  """Дата создания"""
  createdAt: DateTime!
  """Дата обновления"""
  updatedAt: DateTime!
}

"""
Уборка - процесс очистки квартиры.
Обязательно привязана к объекту недвижимости.
Опционально может быть привязана к бронированию и задаче.
"""
type Cleaning {
  """Уникальный идентификатор уборки"""
  id: UUID!
  """Организация"""
  org: Organization!
  """Уборщик (опционально - может быть не назначен)"""
  cleaner: Cleaner
  """Единица недвижимости (обязательно)"""
  unit: Unit!
  """Бронирование (опционально)"""
  booking: Booking
  """Связанная задача (опционально)"""
  taskId: UUID
  """Статус уборки"""
  status: CleaningStatus!
  """Запланированное время"""
  scheduledAt: DateTime!
  """Время начала"""
  startedAt: DateTime
  """Время завершения"""
  completedAt: DateTime
  """Заметки"""
  notes: String
  """Требуется ли смена белья"""
  requiresLinenChange: Boolean!
  """Чеклист уборки"""
  checklistItems: [CleaningChecklist!]!
  """Ревью менеджеров"""
  reviews: [CleaningReview!]!
  """Документы уборки (приемка и сдача)"""
  documents: [CleaningDocument!]!
  """Дата создания"""
  createdAt: DateTime!
  """Дата обновления"""
  updatedAt: DateTime!
}

"""
Пункт чеклиста уборки.
"""
type CleaningChecklist {
  """Уникальный идентификатор пункта"""
  id: UUID!
  """Текст пункта"""
  label: String!
  """Отмечен ли пункт"""
  isChecked: Boolean!
  """Порядок отображения"""
  order: Int!
  """Дата создания"""
  createdAt: DateTime!
  """Дата обновления"""
  updatedAt: DateTime!
}

"""
Документ уборки.
Два типа: приемка квартиры перед уборкой и сдача после уборки.
По первому возвращается залог гостю.
"""
type CleaningDocument {
  """Уникальный идентификатор документа"""
  id: UUID!
  """Уборка"""
  cleaning: Cleaning!
  """Тип документа"""
  type: CleaningDocumentType!
  """Заметки к документу"""
  notes: String
  """Фотографии"""
  photos: [CleaningDocumentPhoto!]!
  """Дата создания"""
  createdAt: DateTime!
  """Дата обновления"""
  updatedAt: DateTime!
}

"""
Фотография в документе уборки.
"""
type CleaningDocumentPhoto {
  """Уникальный идентификатор фото"""
  id: UUID!
  """URL фотографии"""
  url: String!
  """Описание фото"""
  caption: String
  """Порядок отображения"""
  order: Int!
  """Дата создания"""
  createdAt: DateTime!
  """Дата обновления"""
  updatedAt: DateTime!
}

# ===== Connections =====

"""
Соединение уборщиков с пагинацией.
"""
type CleanerConnection {
  """Список уборщиков с курсорами"""
  edges: [CleanerEdge!]!
  """Информация о пагинации"""
  pageInfo: PageInfo!
}

"""
Элемент списка уборщиков для пагинации.
"""
type CleanerEdge {
  """Уборщик"""
  node: Cleaner!
  """Курсор для пагинации"""
  cursor: String!
}

"""
Соединение уборок с пагинацией.
"""
type CleaningConnection {
  """Список уборок с курсорами"""
  edges: [CleaningEdge!]!
  """Информация о пагинации"""
  pageInfo: PageInfo!
}

"""
Элемент списка уборок для пагинации.
"""
type CleaningEdge {
  """Уборка"""
  node: Cleaning!
  """Курсор для пагинации"""
  cursor: String!
}

# ===== Enums =====

"""
Статус уборки.
"""
enum CleaningStatus {
  """Запланирована"""
  SCHEDULED
  """В процессе выполнения"""
  IN_PROGRESS
  """Завершена"""
  COMPLETED
  """Проверена менеджером"""
  APPROVED
  """Отменена"""
  CANCELLED
}

"""
Ревью уборки менеджером
"""
type CleaningReview {
  """Уникальный идентификатор ревью"""
  id: UUID!
  """ID уборки"""
  cleaningId: UUID!
  """Менеджер, утвердивший уборку"""
  managerId: UUID!
  """Статус ревью"""
  status: CleaningReviewStatus!
  """Комментарий менеджера"""
  comment: String
  """Дата создания"""
  createdAt: DateTime!
}

"""Статус ревью уборки"""
enum CleaningReviewStatus {
  """Уборка подтверждена менеджером"""
  APPROVED
}

"""
Тип документа уборки.
"""
enum CleaningDocumentType {
  """Приемка квартиры перед уборкой"""
  PRE_CLEANING_ACCEPTANCE
  """Сдача убранной квартиры"""
  POST_CLEANING_HANDOVER
}

# ===== Inputs =====

"""
Тип уборщика.
"""
enum CleanerType {
  """Сотрудник компании (связан с User)"""
  INTERNAL
  """Внешний подрядчик (не связан с User)"""
  EXTERNAL
}

"""
Входные данные для создания уборщика.
Все данные (имя, email, телефон) берутся из User.
"""
input CreateCleanerInput {
  """ID пользователя системы"""
  userId: UUID!
  """ID организации"""
  orgId: UUID!
}

"""
Входные данные для обновления уборщика.
"""
input UpdateCleanerInput {
  """Имя"""
  firstName: String
  """Фамилия"""
  lastName: String
  """Телефон"""
  phone: String
  """Email"""
  email: String
  """Рейтинг"""
  rating: Float
}

"""
Входные данные для создания шаблона уборки.
"""
input CreateCleaningTemplateInput {
  """ID единицы недвижимости"""
  unitId: UUID!
  """Название шаблона"""
  name: String!
  """Текстовое описание"""
  description: String
  """Требуется ли смена белья"""
  requiresLinenChange: Boolean
  """Расчетная продолжительность в минутах"""
  estimatedDuration: Int
  """Чек-боксы"""
  checklistItems: [ChecklistTemplateItemInput!]
}

"""
Входные данные для обновления шаблона уборки.
"""
input UpdateCleaningTemplateInput {
  """Название шаблона"""
  name: String
  """Текстовое описание"""
  description: String
  """Требуется ли смена белья"""
  requiresLinenChange: Boolean
  """Расчетная продолжительность в минутах"""
  estimatedDuration: Int
  """Чек-боксы"""
  checklistItems: [ChecklistTemplateItemInput!]
}

"""
Входные данные для чек-бокса в шаблоне.
"""
input ChecklistTemplateItemInput {
  """Текст пункта"""
  label: String!
  """Порядок отображения"""
  order: Int
  """Обязателен ли пункт"""
  isRequired: Boolean
}

"""
Входные данные для планирования уборки.
"""
input ScheduleCleaningInput {
  """ID организации"""
  orgId: UUID!
  """ID уборщика (опционально - если не указан, уведомления отправятся привязанным уборщикам)"""
  cleanerId: UUID
  """ID единицы недвижимости (обязательно)"""
  unitId: UUID!
  """ID бронирования (опционально)"""
  bookingId: UUID
  """ID связанной задачи (опционально)"""
  taskId: UUID
  """Запланированное время"""
  scheduledAt: DateTime!
  """Заметки"""
  notes: String
  """Требуется ли смена белья"""
  requiresLinenChange: Boolean
  """Чеклист (если не задан, берется из шаблона)"""
  checklistItems: [ChecklistItemInput!]
}

"""
Входные данные для завершения уборки.
"""
input CompleteCleaningInput {
  """Заметки о завершении"""
  notes: String
  """Финальный чеклист"""
  checklistItems: [ChecklistItemInput!]
}

"""
Входные данные для пункта чеклиста.
"""
input ChecklistItemInput {
  """ID пункта (для обновления существующего)"""
  id: UUID
  """Текст пункта"""
  label: String!
  """Отмечен ли пункт"""
  isChecked: Boolean!
  """Порядок отображения"""
  order: Int
}

"""
Входные данные для создания документа уборки.
"""
input CreateCleaningDocumentInput {
  """Заметки к документу"""
  notes: String
  """Фотографии"""
  photos: [AddPhotoInput!]
}

"""
Входные данные для добавления фото.
"""
input AddPhotoInput {
  """URL фотографии"""
  url: String!
  """Описание фото"""
  caption: String
  """Порядок отображения"""
  order: Int
}

# ===== Checklist Types =====

"""
Чек-лист для уборки.
"""
type Checklist {
  """Уникальный идентификатор чек-листа"""
  id: UUID!
  """Название чек-листа"""
  name: String!
  """Требования (JSON)"""
  requirements: JSON!
  """Требуется ли фото по каждому пункту"""
  requirePhotoPerItem: Boolean!
  """Активен ли чек-лист (только один активный на юнит)"""
  isActive: Boolean!
  """Пункты чек-листа"""
  items: [ChecklistItem!]!
  """Квартира (опционально)"""
  unit: Unit
  """Дата создания"""
  createdAt: DateTime!
  """Дата обновления"""
  updatedAt: DateTime!
}

"""
Пункт чек-листа.
"""
type ChecklistItem {
  """Уникальный идентификатор пункта"""
  id: UUID!
  """Порядок отображения"""
  order: Int!
  """Название пункта"""
  title: String!
  """Описание пункта"""
  description: String
  """Требуется ли фото для этого пункта"""
  requiresPhoto: Boolean!
  """Эталонные фото (шаблон)"""
  templateMedia: [ChecklistItemTemplateMedia!]!
  """Дата создания"""
  createdAt: DateTime!
  """Дата обновления"""
  updatedAt: DateTime!
}

"""
Эталонное фото пункта чек-листа.
"""
type ChecklistItemTemplateMedia {
  """Уникальный идентификатор"""
  id: UUID!
  """Ключ объекта в хранилище"""
  objectKey: String!
  """URL фотографии"""
  url: String!
  """MIME тип"""
  mimeType: String
  """Дата создания"""
  createdAt: DateTime!
}

# ===== Новая модель чек-листов (Template → Instance → Promote) =====

enum ChecklistStage {
  PRE_CLEANING
  CLEANING
  FINAL_REPORT
}

enum ChecklistStatus {
  DRAFT
  SUBMITTED
  LOCKED
}

enum ItemType {
  BOOL
  NUMBER
  TEXT
  SELECT
  MULTISELECT
  PHOTO_ONLY
}

"""
Шаблон чек-листа (версионируемый).
"""
type ChecklistTemplate {
  """Уникальный идентификатор шаблона"""
  id: UUID!
  """ID юнита"""
  unitId: UUID!
  """Юнит"""
  unit: Unit!
  """Версия шаблона"""
  version: Int!
  """Пункты шаблона"""
  items: [ChecklistItemTemplate!]!
  """Дата создания"""
  createdAt: DateTime!
  """Дата обновления"""
  updatedAt: DateTime!
}

"""
Пункт шаблона чек-листа.
"""
type ChecklistItemTemplate {
  """Уникальный идентификатор"""
  id: UUID!
  """Стабильный ключ"""
  key: String!
  """Название пункта"""
  title: String!
  """Описание пункта"""
  description: String
  """Тип пункта"""
  type: ItemType!
  """Обязателен ли пункт"""
  required: Boolean!
  """Требуется ли фото"""
  requiresPhoto: Boolean!
  """Минимальное количество фото"""
  photoMin: Int
  """Порядок отображения"""
  order: Int!
  """Примеры фото для пункта"""
  exampleMedia: [ChecklistItemTemplateMedia!]!
}

"""
Пример фото для пункта шаблона.
"""
type ChecklistItemTemplateMedia {
  """Уникальный идентификатор"""
  id: UUID!
  """URL фото"""
  url: String!
  """Ключ объекта в хранилище"""
  objectKey: String!
  """MIME тип"""
  mimeType: String
  """Подпись к фото"""
  caption: String
  """Порядок отображения"""
  order: Int!
  """Дата создания"""
  createdAt: DateTime!
  """Дата обновления"""
  updatedAt: DateTime!
}

"""
Инстанс чек-листа (для конкретной стадии).
"""
type ChecklistInstance {
  """Уникальный идентификатор инстанса"""
  id: UUID!
  """ID юнита"""
  unitId: UUID!
  """Юнит"""
  unit: Unit!
  """ID уборки"""
  cleaningId: UUID
  """Уборка"""
  cleaning: Cleaning
  """Стадия чек-листа"""
  stage: ChecklistStage!
  """Статус чек-листа"""
  status: ChecklistStatus!
  """ID шаблона"""
  templateId: UUID!
  """Шаблон"""
  template: ChecklistTemplate!
  """Версия шаблона"""
  templateVersion: Int!
  """ID родительского инстанса (для промоута)"""
  parentInstanceId: UUID
  """Родительский инстанс"""
  parentInstance: ChecklistInstance
  """Пункты чек-листа (полная копия)"""
  items: [ChecklistInstanceItem!]!
  """Ответы на пункты"""
  answers: [ChecklistAnswer!]!
  """Аттачменты (фото)"""
  attachments: [ChecklistAttachment!]!
  """Дата создания"""
  createdAt: DateTime!
  """Дата обновления"""
  updatedAt: DateTime!
}

"""
Пункт инстанса чек-листа.
"""
type ChecklistInstanceItem {
  """Уникальный идентификатор"""
  id: UUID!
  """Ключ пункта"""
  key: String!
  """Название пункта"""
  title: String!
  """Описание пункта"""
  description: String
  """Тип пункта"""
  type: ItemType!
  """Обязателен ли пункт"""
  required: Boolean!
  """Требуется ли фото"""
  requiresPhoto: Boolean!
  """Минимальное количество фото"""
  photoMin: Int
  """Порядок отображения"""
  order: Int!
}

"""
Ответ на пункт чек-листа.
"""
type ChecklistAnswer {
  """Уникальный идентификатор"""
  id: UUID!
  """Ключ пункта"""
  itemKey: String!
  """Значение ответа (JSON)"""
  value: JSON
  """Заметка"""
  note: String
  """Дата создания"""
  createdAt: DateTime!
  """Дата обновления"""
  updatedAt: DateTime!
}

"""
Аттачмент (фото) к пункту чек-листа.
"""
type ChecklistAttachment {
  """Уникальный идентификатор"""
  id: UUID!
  """Ключ пункта"""
  itemKey: String!
  """URL фото (MinIO)"""
  url: String!
  """Подпись к фото"""
  caption: String
  """Дата создания"""
  createdAt: DateTime!
}

"""
Presigned URL для прямой загрузки файла.
"""
type PresignedUploadUrl {
  """Presigned PUT URL для загрузки"""
  url: String!
  """Ключ объекта в хранилище"""
  objectKey: String!
  """Время жизни URL в секундах"""
  expiresIn: Int!
  """MIME тип файла"""
  mimeType: String
}

# ===== Checklist Inputs =====

"""
Входные данные для создания чек-листа.
"""
input CreateChecklistInput {
  """Название чек-листа"""
  name: String!
  """Требуется ли фото по каждому пункту (по умолчанию: true)"""
  requirePhotoPerItem: Boolean = true
  """Пункты чек-листа"""
  items: [CreateChecklistItemInput!]!
  """ID квартиры (опционально)"""
  unitId: UUID
  """Требования (JSON)"""
  requirements: JSON
}

"""
Входные данные для создания пункта чек-листа.
"""
input CreateChecklistItemInput {
  """ID пункта (для обновления существующего пункта)"""
  id: UUID
  """Порядок отображения"""
  order: Int!
  """Название пункта"""
  title: String!
  """Описание пункта"""
  description: String
  """Требуется ли фото для этого пункта (по умолчанию: true)"""
  requiresPhoto: Boolean = true
}

"""
Входные данные для получения presigned URLs для загрузки фото выполнения пункта.
"""
input GetSubmissionMediaUploadUrlsInput {
  """ID заполнения пункта"""
  checklistSubmissionId: UUID!
  """Количество файлов"""
  count: Int!
  """MIME типы файлов (по индексу)"""
  mimeTypes: [String!]
}

# ===== Inputs для новой модели чек-листов =====

input AddItemInput {
  """ID инстанса"""
  instanceId: UUID!
  """Ключ пункта (уникальный в рамках инстанса)"""
  key: String!
  """Название пункта"""
  title: String!
  """Описание пункта"""
  description: String
  """Тип пункта"""
  type: ItemType!
  """Обязателен ли пункт"""
  required: Boolean = false
  """Требуется ли фото"""
  requiresPhoto: Boolean = false
  """Минимальное количество фото"""
  photoMin: Int
  """Порядок отображения"""
  order: Int
}

input UpdateItemInput {
  """ID инстанса"""
  instanceId: UUID!
  """Ключ пункта"""
  itemKey: String!
  """Название пункта"""
  title: String
  """Описание пункта"""
  description: String
  """Тип пункта"""
  type: ItemType
  """Обязателен ли пункт"""
  required: Boolean
  """Требуется ли фото"""
  requiresPhoto: Boolean
  """Минимальное количество фото"""
  photoMin: Int
  """Порядок отображения"""
  order: Int
}

input AnswerInput {
  """ID инстанса"""
  instanceId: UUID!
  """Ключ пункта"""
  itemKey: String!
  """Значение ответа (JSON)"""
  value: JSON
  """Заметка"""
  note: String
}

input AttachmentInput {
  """ID инстанса"""
  instanceId: UUID!
  """Ключ пункта"""
  itemKey: String!
  """Ключ объекта в хранилище"""
  objectKey: String!
  """URL фото (опционально, если не указан - будет создан из objectKey)"""
  url: String
  """Подпись к фото"""
  caption: String
}

input GetChecklistAttachmentUploadUrlsInput {
  """ID инстанса"""
  instanceId: UUID!
  """Ключ пункта"""
  itemKey: String!
  """Количество файлов"""
  count: Int!
  """MIME типы файлов (по индексу)"""
  mimeTypes: [String!]
}

# ===== Inputs для редактирования шаблона =====

input AddTemplateItemInput {
  """ID шаблона"""
  templateId: UUID!
  """Ключ пункта (уникальный в рамках шаблона)"""
  key: String!
  """Название пункта"""
  title: String!
  """Описание пункта"""
  description: String
  """Тип пункта"""
  type: ItemType = BOOL
  """Обязателен ли пункт"""
  required: Boolean = false
  """Требуется ли фото"""
  requiresPhoto: Boolean = false
  """Минимальное количество фото"""
  photoMin: Int
  """Порядок отображения"""
  order: Int
}

input UpdateTemplateItemInput {
  """ID шаблона"""
  templateId: UUID!
  """Ключ пункта"""
  itemKey: String!
  """Название пункта"""
  title: String
  """Описание пункта"""
  description: String
  """Тип пункта"""
  type: ItemType
  """Обязателен ли пункт"""
  required: Boolean
  """Требуется ли фото"""
  requiresPhoto: Boolean
  """Минимальное количество фото"""
  photoMin: Int
  """Порядок отображения"""
  order: Int
}

input TemplateItemExampleFileInput {
  """Ключ объекта в хранилище"""
  objectKey: String!
  """MIME тип"""
  mimeType: String
  """URL фото (опционально, если не указан - будет создан из objectKey)"""
  url: String
  """Подпись к фото"""
  caption: String
}

input AddTemplateItemExampleMediaInput {
  """ID шаблона"""
  templateId: UUID!
  """Ключ пункта"""
  itemKey: String!
  """Загруженные файлы"""
  files: [TemplateItemExampleFileInput!]!
}

input GetTemplateItemExampleMediaUploadUrlsInput {
  """ID шаблона"""
  templateId: UUID!
  """Ключ пункта"""
  itemKey: String!
  """Количество файлов"""
  count: Int!
  """MIME типы файлов (по индексу)"""
  mimeTypes: [String!]
}

