# Pricing Subgraph - Управление ценообразованием уборок и ремонтов
# Отвечает за расчёт стоимости уборок и ремонтов на основе градации юнитов и сложности

scalar UUID
scalar DateTime
scalar JSON

"""
Денежная сумма с валютой.
Amount хранится в копейках/центах для точности вычислений.
Пример: {amount: 150000, currency: "RUB"} = 1500.00 RUB
"""
type Money {
  """Сумма в копейках/центах (минимальная единица валюты)"""
  amount: Int!
  """Код валюты в формате ISO 4217 (RUB, USD, EUR)"""
  currency: String!
}

"""
Входные данные для денежной суммы.
Используется в мутациях для создания/обновления денежных значений.
"""
input MoneyInput {
  """Сумма в копейках/центах"""
  amount: Int!
  """Код валюты в формате ISO 4217"""
  currency: String!
}

"""
Градация юнита по размеру (0-10).
"""
enum UnitGrade {
  GRADE_0
  GRADE_1
  GRADE_2
  GRADE_3
  GRADE_4
  GRADE_5
  GRADE_6
  GRADE_7
  GRADE_8
  GRADE_9
  GRADE_10
}

"""
Сложность уборки (0-5).
"""
enum CleaningDifficulty {
  D0
  D1
  D2
  D3
  D4
  D5
}

"""
Размер ремонта в часах (0-10).
"""
enum RepairSize {
  SIZE_0
  SIZE_1
  SIZE_2
  SIZE_3
  SIZE_4
  SIZE_5
  SIZE_6
  SIZE_7
  SIZE_8
  SIZE_9
  SIZE_10
}

"""
Сложность ремонта (0-5).
"""
enum RepairDifficulty {
  D0
  D1
  D2
  D3
  D4
  D5
}

"""
Режим коэффициентов ценообразования.
"""
enum CleaningCoeffMode {
  BASIC
  INCREASED
}

"""
Режим коэффициентов ценообразования для ремонтов.
"""
enum RepairCoeffMode {
  BASIC
  INCREASED
}

"""
Правила расчёта стоимости для юнита/организации.
"""
type CleaningPricingRule {
  id: UUID!
  orgId: UUID!
  unitId: UUID
  mode: CleaningCoeffMode!
  baseCleaningPrice: Money!
  gradeStep: Float!
  difficultyStep: Float!
  increasedDifficultyDelta: Float!
  extras: JSON
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
Квота/калькуляция стоимости уборки.
"""
type CleaningCostQuote {
  unitId: UUID!
  grade: UnitGrade!
  difficulty: CleaningDifficulty!
  mode: CleaningCoeffMode!
  base: Money!
  gradeCoefficient: Float!
  difficultyCoefficient: Float!
  total: Money!
}

"""
Правила расчёта стоимости для ремонтов.
"""
type RepairPricingRule {
  id: UUID!
  orgId: UUID!
  unitId: UUID
  mode: RepairCoeffMode!
  baseRepairPrice: Money!
  gradeStep: Float!
  difficultyStep: Float!
  increasedDifficultyDelta: Float!
  extras: JSON
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
Квота/калькуляция стоимости ремонта.
"""
type RepairCostQuote {
  unitId: UUID!
  size: RepairSize!
  difficulty: RepairDifficulty!
  mode: RepairCoeffMode!
  base: Money!
  sizeCoefficient: Float!
  difficultyCoefficient: Float!
  materialsCost: Money! # Сумма расходников (shoppingItems)
  total: Money!
}

"""
Запросы для работы с ценообразованием.
"""
type Query {
  """Получить правило ценообразования"""
  cleaningPricingRule(
    orgId: UUID!
    unitId: UUID
  ): CleaningPricingRule
  
  """Получить все правила для организации/юнита"""
  cleaningPricingRules(
    orgId: UUID!
    unitId: UUID
  ): [CleaningPricingRule!]!
  
  """Рассчитать стоимость уборки"""
  calculateCleaningCost(
    unitId: UUID!
    grade: UnitGrade
    difficulty: CleaningDifficulty
    mode: CleaningCoeffMode
  ): CleaningCostQuote!
  
  """Получить правило ценообразования для ремонта"""
  repairPricingRule(
    orgId: UUID!
    unitId: UUID
  ): RepairPricingRule
  
  """Получить все правила для ремонта организации/юнита"""
  repairPricingRules(
    orgId: UUID!
    unitId: UUID
  ): [RepairPricingRule!]!
  
  """Рассчитать стоимость ремонта"""
  calculateRepairCost(
    unitId: UUID!
    repairId: UUID!
    size: RepairSize
    difficulty: RepairDifficulty
    mode: RepairCoeffMode
  ): RepairCostQuote!
}

"""
Входные данные для создания/обновления правила ценообразования.
"""
input UpsertCleaningPricingRuleInput {
  orgId: UUID!
  unitId: UUID
  mode: CleaningCoeffMode!
  baseCleaningPrice: MoneyInput!
  gradeStep: Float
  difficultyStep: Float
  increasedDifficultyDelta: Float
  extras: JSON
}

"""
Входные данные для создания/обновления правила ценообразования для ремонта.
"""
input UpsertRepairPricingRuleInput {
  orgId: UUID!
  unitId: UUID
  mode: RepairCoeffMode!
  baseRepairPrice: MoneyInput!
  gradeStep: Float
  difficultyStep: Float
  increasedDifficultyDelta: Float
  extras: JSON
}

"""
Мутации для работы с ценообразованием.
"""
type Mutation {
  """Создать или обновить правило ценообразования"""
  upsertCleaningPricingRule(
    input: UpsertCleaningPricingRuleInput!
  ): CleaningPricingRule!
  
  """Удалить правило ценообразования"""
  deleteCleaningPricingRule(id: UUID!): Boolean!
  
  """Создать или обновить правило ценообразования для ремонта"""
  upsertRepairPricingRule(
    input: UpsertRepairPricingRuleInput!
  ): RepairPricingRule!
  
  """Удалить правило ценообразования для ремонта"""
  deleteRepairPricingRule(id: UUID!): Boolean!
}

